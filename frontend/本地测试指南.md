# 本地测试指南

## 测试环境准备

### 1. 后端服务
后端服务已经在运行中（端口 8000）

**验证后端服务：**
```bash
curl http://localhost:8000/health
```

预期响应：
```json
{"status":"healthy"}
```

### 2. 前端环境
需要使用微信开发者工具

**下载地址：**
https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

## 测试步骤

### 步骤 1：打开微信开发者工具

1. 启动微信开发者工具
2. 选择"小程序"
3. 点击"导入项目"

### 步骤 2：导入前端项目

1. **项目目录：** 选择 `c:\Users\cj783\Desktop\材料项目\frontend`
2. **AppID：** 选择"测试号"（或使用你的小程序 AppID）
3. **项目名称：** 家具健康检测器
4. 点击"导入"

### 步骤 3：配置开发环境

1. 点击右上角"详情"按钮
2. 在"本地设置"中勾选：
   - ✅ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
   - ✅ 不校验安全域名、TLS 版本以及 HTTPS 证书
3. 点击"确定"

### 步骤 4：测试家具检测功能

#### 4.1 进入家具检测页面
1. 在模拟器中点击"家具检测"
2. 或直接在页面路径中输入：`pages/furniture-detect/detect`

#### 4.2 测试拍照识别
1. 点击"拍照识别"按钮
2. 选择一张家具图片（建议使用项目中的测试图片）
3. 等待识别结果（约 3-5 秒）

**测试图片位置：**
- `test_images_simple/` 目录下有测试图片
- 或使用任何家具图片

#### 4.3 验证检测结果
检查以下内容：
- ✅ 显示加载提示"识别中..."
- ✅ 识别完成后显示"识别完成"
- ✅ 展示检测结果（家具类型、材料信息）
- ✅ 显示风险等级和置信度

#### 4.4 查看详细报告
1. 点击"查看详细报告"按钮
2. 验证弹窗显示完整的检测信息

### 步骤 5：测试分享卡片功能

#### 5.1 生成分享卡片
1. 在检测结果页面点击"生成分享卡片"
2. 跳转到分享卡片页面
3. 等待卡片生成（约 2-3 秒）

#### 5.2 验证分享卡片
检查以下内容：
- ✅ 显示加载提示"生成中..."
- ✅ 生成完成后显示"生成成功"
- ✅ 展示分享卡片图片
- ✅ 可以选择不同模板（modern/classic/minimal）

#### 5.3 测试保存功能
1. 点击"保存到相册"按钮
2. 授权访问相册（首次使用）
3. 验证图片保存成功

### 步骤 6：测试错误处理

#### 6.1 测试网络错误
1. 停止后端服务
2. 尝试进行家具检测
3. 验证显示错误提示："网络连接失败，请检查网络"

#### 6.2 测试图片大小限制
1. 选择一张超过 10MB 的图片
2. 验证显示错误提示："图片大小超过限制"

#### 6.3 测试重复提交
1. 快速连续点击"拍照识别"按钮
2. 验证只会触发一次识别（防止重复提交）

## 调试技巧

### 1. 查看控制台日志
在微信开发者工具中：
1. 点击"调试器"标签
2. 选择"Console"
3. 查看 API 调用日志和错误信息

### 2. 查看网络请求
1. 点击"Network"标签
2. 查看 API 请求和响应
3. 验证请求参数和响应数据

### 3. 常见问题排查

#### 问题 1：无法连接后端
**症状：** 显示"网络连接失败"
**解决方案：**
1. 检查后端服务是否运行：`curl http://localhost:8000/health`
2. 检查是否关闭了域名校验
3. 检查 `frontend/utils/api.js` 中的 `BASE_URL` 配置

#### 问题 2：图片上传失败
**症状：** 显示"图片上传失败"
**解决方案：**
1. 检查图片格式（支持 JPG、PNG）
2. 检查图片大小（不超过 10MB）
3. 查看控制台错误日志

#### 问题 3：识别结果为空
**症状：** 识别完成但没有结果
**解决方案：**
1. 检查后端 API 响应数据
2. 确认图片清晰度足够
3. 查看后端日志

## 测试检查清单

### 功能测试
- [ ] 拍照识别功能正常
- [ ] 从相册选择功能正常
- [ ] 图片上传成功
- [ ] AI 识别返回结果
- [ ] 检测结果正确展示
- [ ] 查看详细报告功能正常
- [ ] 生成分享卡片功能正常
- [ ] 保存到相册功能正常
- [ ] 分享功能正常

### 错误处理测试
- [ ] 网络错误提示正确
- [ ] 图片大小限制提示正确
- [ ] 参数错误提示正确
- [ ] 服务器错误提示正确
- [ ] 防止重复提交有效

### 用户体验测试
- [ ] 加载提示显示正常
- [ ] 错误提示友好清晰
- [ ] 页面跳转流畅
- [ ] 按钮响应及时
- [ ] 图片展示清晰

## 性能测试

### 响应时间
- 图片上传：< 3 秒
- AI 识别：< 5 秒
- 分享卡片生成：< 2 秒

### 测试方法
在控制台中查看网络请求时间：
```javascript
console.time('detect');
// 执行检测
console.timeEnd('detect');
```

## 下一步

测试完成后：
1. 记录发现的问题
2. 优化用户体验
3. 准备生产环境部署

## 联系方式

如遇到问题：
- 查看 [API集成说明.md](API集成说明.md)
- 查看 [前后端集成测试报告.md](../前后端集成测试报告.md)
- 检查后端日志：`backend/logs/app.log`

---

**测试指南创建时间：** 2026-01-30
